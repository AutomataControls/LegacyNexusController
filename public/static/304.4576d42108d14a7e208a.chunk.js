"use strict";(self.webpackChunkautomata_neural_nexus_portal=self.webpackChunkautomata_neural_nexus_portal||[]).push([[304],{2102:(e,t,r)=>{r.d(t,{$:()=>l});var o=r(4848),a=r(6540),s=r(3362);function n(...e){return e.filter(Boolean).join(" ")}const i=(0,r(2732).F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",teal:"bg-teal-500/10 text-teal-600 hover:bg-teal-500/20 border border-teal-200",sidebar:"w-full justify-start text-left bg-transparent hover:bg-gradient-to-r hover:from-teal-500/10 hover:to-cyan-500/10 transition-all duration-200",sidebarActive:"w-full justify-start text-left bg-gradient-to-r from-teal-500/20 to-cyan-500/20 border-l-3 border-teal-500"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef(({className:e,variant:t,size:r,asChild:a=!1,...l},c)=>{const d=a?s.DX:"button";return(0,o.jsx)(d,{className:n(i({variant:t,size:r,className:e})),ref:c,...l})});l.displayName="Button"},3304:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var o=r(4848),a=r(6540),s=r(4296),n=r(1096),i=r(4653),l=r(7158),c=r(9107),d=r(8825),p=r(7984),h=r(5869),u=r(2746),m=r(5107),f=r(9721),g=r(9095),b=r(2102);const x=()=>{const[e,t]=(0,a.useState)("temperature"),[r,x]=(0,a.useState)([]),[y,j]=(0,a.useState)(8),[v,k]=(0,a.useState)(!1),[S,w]=(0,a.useState)([]),[F,N]=(0,a.useState)([]),[W,A]=(0,a.useState)(0),[D,C]=(0,a.useState)([]),[_,z]=(0,a.useState)(new Map),[M,$]=(0,a.useState)(null),[T,K]=(0,a.useState)(null),[O,I]=(0,a.useState)(null),[L]=(0,a.useState)({tempHigh:85,tempLow:65,ampsHigh:40,ampsLow:5,vibrationWarning:4.5,vibrationCritical:7.1}),R=async()=>{try{const e=await fetch("/api/boards/current-readings");if(e.ok){const t=await e.json(),r=new Date,o={time:y>8?r.toLocaleString("en-US",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit",timeZone:"America/New_York"}):r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZone:"America/New_York"})};if(t.inputs){let e=1;const r=new Map;Object.entries(t.inputs).forEach(([t,a])=>{const s=t.toLowerCase();if(s.includes("tower")&&s.includes("supply"))o.supply=parseFloat(a);else if(s.includes("tower")&&s.includes("return"))o.return=parseFloat(a);else if(s.includes("hp")&&s.includes("supply"))o.hpSupply=parseFloat(a),o.supply||(o.supply=parseFloat(a));else if(s.includes("hp")&&s.includes("return"))o.return||(o.return=parseFloat(a));else if(s.includes("outdoor_air")||s.includes("oat"))o.oat=parseFloat(a);else if("space"===s||s.includes("space_temp"))o.space=parseFloat(a);else if(s.includes("current")||s.includes("amps")||s.includes("vfd")){const s=`amps${e}`;o[s]=parseFloat(a),r.set(s,t),e++}else"setpoint"===s&&(o.setpoint=parseFloat(a))}),r.size>0&&z(r)}if(t.outputs&&t.outputs.triacs&&(o.triac1=t.outputs.triacs.triac1?1:0,o.triac2=t.outputs.triacs.triac2?1:0,o.triac3=t.outputs.triacs.triac3?1:0,o.triac4=t.outputs.triacs.triac4?1:0),void 0!==o.supply&&null!==T){const e=o.supply-T;e<0&&console.warn(`Invalid approach temp: Supply=${o.supply}°F, WetBulb=${T}°F, Approach=${e}°F`),$(e)}else console.log(`Cannot calculate approach: Supply=${o.supply}, WetBulb=${T}`);if(void 0!==o.supply&&void 0!==o.return&&void 0!==o.hpSupply){const e=o.hpSupply-o.return;if(0!==e){const t=(o.supply-o.return)/e*100;I(Math.min(100,Math.max(0,t)))}}Object.keys(o).length>1&&(k(!0),x(e=>{const t=[...e,o],r=y<=1?1:y<=4?5:15,a=Math.floor(60*y/r);return t.length>a?t.slice(-a):t}))}}catch(e){console.error("Failed to fetch sensor data:",e),k(!1)}};(0,a.useEffect)(()=>{(async()=>{try{const e=await fetch(`/api/boards/historical-data?hours=${y}`);if(e.ok){const t=await e.json();t&&t.length>0&&(x(t),k(!0))}}catch(e){console.error("Failed to load historical data:",e)}})()},[y]);const B=async()=>{try{const e=await fetch("/api/vibration/configs");if(e.ok){const t=(await e.json()).filter(e=>e.enabled);if(w(t),t.length>0&&t[W]){const e=t[W],r=await fetch(`/api/vibration/history/${e.sensor_id}?hours=1`);if(r.ok){const e=(await r.json()).map(e=>({time:new Date(e.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZone:"America/New_York"}),velocity:e.velocity_mms,velocityX:e.velocity_x,velocityY:e.velocity_y,velocityZ:e.velocity_z,temperature:e.temperature_f}));C(e)}}}const t=await fetch("/api/vibration/readings");if(t.ok){const e=await t.json(),r={time:(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZone:"America/New_York"})};let o=[];"object"!=typeof e||Array.isArray(e)?Array.isArray(e)&&(o=e):o=Object.values(e),o.slice(0,5).forEach((e,t)=>{r[`vibration${t+1}`]=e.velocity_mms||0}),N(e=>{const t=[...e,r];return t.length>50?t.slice(-50):t})}}catch(e){console.error("Failed to fetch vibration data:",e)}},E=async()=>{try{const e=await fetch("/api/weather");if(e.ok){const t=await e.json();t.wetBulb&&(K(t.wetBulb),console.log("Wet bulb temperature updated:",t.wetBulb))}}catch(e){console.error("Failed to fetch weather data:",e)}};return(0,a.useEffect)(()=>{E();const e=setInterval(E,6e5);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{E(),R();const e=setInterval(R,3e4);return()=>clearInterval(e)},[y]),(0,a.useEffect)(()=>{if("vibration"===e){B();const e=setInterval(B,3e4);return()=>clearInterval(e)}},[e,W]),(0,o.jsxs)("div",{className:"trend-graph-card",children:[(0,o.jsxs)("div",{className:"trend-header",children:[(0,o.jsx)("button",{className:"trend-nav-btn",onClick:()=>{const r=["temperature","amps","triacs","vibration"],o=r.indexOf(e);t(r[(o-1+r.length)%r.length])},children:"‹"}),(0,o.jsx)(b.$,{variant:"vibration"===e?"default":"outline",onClick:()=>t("vibration"===e?"temperature":"vibration"),title:"Vibration Monitoring - ISO 10816-3",style:{fontSize:"10px",padding:"4px 8px",height:"32px",width:"auto"},children:"ISO-10816"}),"vibration"===e&&S.length>1&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{onClick:()=>{S.length>0&&A(e=>(e-1+S.length)%S.length)},title:"Previous Sensor",style:{padding:"2px 4px",fontSize:"10px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer"},children:(0,o.jsx)(f.A,{style:{width:"12px",height:"12px"}})}),(0,o.jsx)("button",{onClick:()=>{S.length>0&&A(e=>(e+1)%S.length)},title:"Next Sensor",style:{padding:"2px 4px",fontSize:"10px",border:"1px solid #d1d5db",borderRadius:"4px",background:"white",cursor:"pointer"},children:(0,o.jsx)(m.A,{style:{width:"12px",height:"12px"}})})]}),(0,o.jsxs)("h3",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:["temperature"===e&&(0,o.jsxs)("div",{style:{display:"flex",gap:"20px",fontSize:"0.875rem",fontWeight:600,marginBottom:"4px"},children:[(0,o.jsxs)("span",{style:{color:null!==M?M<0?"#ef4444":"#059669":"#6b7280"},children:["Approach: ",null!==M?`${M.toFixed(1)}°F`:"--"]}),(0,o.jsxs)("span",{style:{color:null!==O?O>80?"#059669":O>60?"#f59e0b":"#ef4444":"#6b7280"},children:["HX Eff: ",null!==O?`${O.toFixed(1)}%`:"--"]})]}),(0,o.jsx)("span",{children:"vibration"===e&&S[W]?`${S[W].equipment_name} Vibration`:{temperature:"Temperature Trends",amps:"Current Trends",triacs:"VFD Enable Status",vibration:"Vibration Monitoring"}[e]})]}),(0,o.jsxs)("div",{className:"trend-controls",children:[(0,o.jsxs)("select",{className:"time-range-select",value:y,onChange:e=>j(Number(e.target.value)),children:[(0,o.jsx)("option",{value:1,children:"1 Hour"}),(0,o.jsx)("option",{value:4,children:"4 Hours"}),(0,o.jsx)("option",{value:8,children:"8 Hours"}),(0,o.jsx)("option",{value:24,children:"24 Hours"})]}),(0,o.jsxs)("div",{className:"trend-status",children:[(0,o.jsx)("span",{className:"status-dot "+(v?"connected":"disconnected")}),v?"Live":"Offline"]})]}),(0,o.jsx)("button",{className:"trend-nav-btn",onClick:()=>{const r=["temperature","amps","triacs","vibration"],o=r.indexOf(e);t(r[(o+1)%r.length])},children:"›"})]}),(0,o.jsx)("div",{style:{padding:"1rem"},children:(()=>{if(!v||0===r.length)return(0,o.jsxs)("div",{style:{height:250,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f9fafb",borderRadius:"8px",border:"2px dashed #d1d5db"},children:[(0,o.jsx)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"#9ca3af",strokeWidth:"2",children:(0,o.jsx)("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})}),(0,o.jsx)("h3",{style:{marginTop:"1rem",marginBottom:"0.5rem",color:"#6b7280",fontSize:"1.125rem",fontWeight:600},children:"Connect Sensors"}),(0,o.jsx)("p",{style:{color:"#9ca3af",fontSize:"0.875rem",textAlign:"center",maxWidth:"250px"},children:"No sensor data available. Please ensure boards are connected and configured."})]});if("temperature"===e)return(0,o.jsx)(i.u,{width:"100%",height:250,children:(0,o.jsxs)(u.b,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[(0,o.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,o.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:(()=>{const e=r.length;return y<=1?Math.max(1,Math.floor(e/6)):y<=4||y<=8?Math.max(1,Math.floor(e/8)):Math.max(1,Math.floor(e/10))})(),angle:-45,textAnchor:"end",height:60}),(0,o.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[50,95],tickFormatter:e=>`${e.toFixed(0)}°F`}),(0,o.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>[`${e?.toFixed(1)}°F`,""]}),(0,o.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,o.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,o.jsx)(l.e,{y:L.tempHigh,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5"}),(0,o.jsx)(l.e,{y:L.tempLow,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5"}),(0,o.jsx)(l.e,{y:70,stroke:"rgba(34, 197, 94, 0.3)",strokeDasharray:"3 3",label:"Setpoint"}),r.some(e=>void 0!==e.supply)&&(0,o.jsx)(d.N,{type:"monotone",dataKey:"supply",stroke:"rgba(14, 165, 233, 0.3)",strokeWidth:2.5,dot:!1,name:"Tower Supply",legendType:"line"}),r.some(e=>void 0!==e.return)&&(0,o.jsx)(d.N,{type:"monotone",dataKey:"return",stroke:"rgba(245, 158, 11, 0.3)",strokeWidth:2.5,dot:!1,name:"Tower Return",legendType:"line"}),r.some(e=>void 0!==e.oat)&&(0,o.jsx)(d.N,{type:"monotone",dataKey:"oat",stroke:"#8b5cf6",strokeWidth:2,dot:!1,name:"Outside Air"}),r.some(e=>void 0!==e.space)&&(0,o.jsx)(d.N,{type:"monotone",dataKey:"space",stroke:"#10b981",strokeWidth:2,dot:!1,name:"Space"}),r.some(e=>void 0!==e.hpSupply)&&(0,o.jsx)(d.N,{type:"monotone",dataKey:"hpSupply",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,dot:!1,name:"HP Loop Supply",legendType:"line"})]})});if("amps"===e){const e=["#f59e0b","#0ea5e9","#10b981","#8b5cf6","#ec4899","#06b6d4"],t=new Set;return r.forEach(e=>{Object.keys(e).forEach(e=>{e.startsWith("amps")&&"amps"!==e&&t.add(e)})}),(0,o.jsx)(i.u,{width:"100%",height:250,children:(0,o.jsxs)(u.b,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[(0,o.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,o.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:y<=1?"preserveStartEnd":y<=4?Math.floor(r.length/8):Math.floor(r.length/6),angle:-45,textAnchor:"end",height:60}),(0,o.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[0,50],tickFormatter:e=>`${e.toFixed(0)}A`}),(0,o.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>[`${e?.toFixed(1)}A`,""]}),(0,o.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,o.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,o.jsx)(l.e,{y:L.ampsHigh,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5",label:"High Limit"}),(0,o.jsx)(l.e,{y:L.ampsLow,stroke:"rgba(34, 197, 94, 0.3)",strokeDasharray:"5 5",label:"Running"}),Array.from(t).sort().map((t,r)=>{const a=(_.get(t)||t).replace(/_/g," ").replace(/tower/gi,"Tower").replace(/pump/gi,"Pump").replace(/vfd/gi,"VFD").replace(/current/gi,"").replace(/amps/gi,"").trim();return(0,o.jsx)(d.N,{type:"monotone",dataKey:t,stroke:e[r%e.length],strokeWidth:2.5,dot:!1,name:a||`Current ${r+1}`},t)})]})})}if("vibration"===e){const e=S[W];if(0===S.length)return(0,o.jsxs)("div",{style:{height:250,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f9fafb",borderRadius:"8px",border:"2px dashed #d1d5db"},children:[(0,o.jsx)(g.A,{size:64,color:"#9ca3af"}),(0,o.jsx)("h3",{style:{marginTop:"1rem",marginBottom:"0.5rem",color:"#6b7280",fontSize:"1.125rem",fontWeight:600},children:"No Vibration Sensors"}),(0,o.jsx)("p",{style:{color:"#9ca3af",fontSize:"0.875rem",textAlign:"center",maxWidth:"250px"},children:"Configure vibration sensors in the Vibration page to see data here."})]});const t=e&&D.length>0?D:F.length>0?F:[];return 0===t.length?(0,o.jsx)("div",{style:{height:250,display:"flex",alignItems:"center",justifyContent:"center",background:"#f9fafb",borderRadius:"8px"},children:(0,o.jsx)("p",{style:{color:"#9ca3af"},children:"Waiting for sensor data..."})}):(0,o.jsx)(i.u,{width:"100%",height:250,children:(0,o.jsxs)(u.b,{data:t,margin:{top:5,right:30,left:20,bottom:5},children:[(0,o.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,o.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:"preserveStartEnd",angle:-45,textAnchor:"end",height:60}),(0,o.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[0,15],tickFormatter:e=>`${e.toFixed(2)} mm/s`}),(0,o.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>[`${e?.toFixed(2)} mm/s`,""]}),(0,o.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,o.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,o.jsx)(l.e,{y:2.8,stroke:"rgba(34, 197, 94, 0.3)",strokeDasharray:"5 5",label:"Zone A (Good)"}),(0,o.jsx)(l.e,{y:L.vibrationWarning,stroke:"rgba(245, 158, 11, 0.3)",strokeDasharray:"5 5",label:"Zone B (Acceptable)"}),(0,o.jsx)(l.e,{y:L.vibrationCritical,stroke:"rgba(239, 68, 68, 0.3)",strokeDasharray:"5 5",label:"Zone C (Warning)"}),(0,o.jsx)(l.e,{y:11,stroke:"rgba(220, 38, 38, 0.3)",strokeDasharray:"5 5",label:"Zone D (Critical)"}),e&&t===D?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.N,{type:"monotone",dataKey:"velocity",stroke:"#06b6d4",strokeWidth:2.5,dot:!1,name:`${e.equipment_name} - RMS`}),(0,o.jsx)(d.N,{type:"monotone",dataKey:"velocityX",stroke:"#8b5cf6",strokeWidth:1.5,dot:!1,name:"X-axis"}),(0,o.jsx)(d.N,{type:"monotone",dataKey:"velocityY",stroke:"#ec4899",strokeWidth:1.5,dot:!1,name:"Y-axis"}),(0,o.jsx)(d.N,{type:"monotone",dataKey:"velocityZ",stroke:"#10b981",strokeWidth:1.5,dot:!1,name:"Z-axis"})]}):(0,o.jsx)(o.Fragment,{children:S.slice(0,5).map((e,t)=>(0,o.jsx)(d.N,{type:"monotone",dataKey:`vibration${t+1}`,stroke:["#06b6d4","#8b5cf6","#ec4899","#10b981","#f59e0b"][t],strokeWidth:2,dot:!1,name:e.equipment_name},e.sensor_id))})]})})}return(0,o.jsx)(i.u,{width:"100%",height:250,children:(0,o.jsxs)(u.b,{data:r,margin:{top:5,right:30,left:20,bottom:5},children:[(0,o.jsx)(c.d,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),(0,o.jsx)(p.W,{dataKey:"time",stroke:"#9ca3af",fontSize:12,interval:(()=>{const e=r.length;return y<=1?Math.max(1,Math.floor(e/6)):y<=4||y<=8?Math.max(1,Math.floor(e/8)):Math.max(1,Math.floor(e/10))})(),angle:-45,textAnchor:"end",height:60}),(0,o.jsx)(h.h,{stroke:"#9ca3af",fontSize:12,domain:[0,1],ticks:[0,1],tickFormatter:e=>e>.5?"ON":"OFF"}),(0,o.jsx)(n.m,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #e5e7eb",borderRadius:"0.375rem"},formatter:e=>e>.5?"ON":"OFF"}),(0,o.jsx)(s.s,{iconType:"line",formatter:(e,t)=>(0,o.jsx)("span",{style:{color:t.color&&t.color.includes("rgba")?t.color.replace(/[\d.]+\)/,"1)"):t.color,fontWeight:600},children:e})}),(0,o.jsx)(d.N,{type:"stepAfter",dataKey:"triac1",stroke:"#0ea5e9",strokeWidth:2.5,dot:!1,name:"Tower 1 VFD"}),(0,o.jsx)(d.N,{type:"stepAfter",dataKey:"triac2",stroke:"#10b981",strokeWidth:2.5,dot:!1,name:"Tower 2 VFD"}),(0,o.jsx)(d.N,{type:"stepAfter",dataKey:"triac3",stroke:"#f59e0b",strokeWidth:2.5,dot:!1,name:"Tower 3 VFD"}),(0,o.jsx)(d.N,{type:"stepAfter",dataKey:"triac4",stroke:"#8b5cf6",strokeWidth:2,strokeDasharray:"5 5",dot:!1,name:"Spare"})]})})})()})]})}}}]);